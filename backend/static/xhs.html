<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“• å°çº¢ä¹¦åˆ›ä½œåŠ©æ‰‹ - vibe-blog</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #FFF8F0 0%, #FFE4D6 50%, #FFAB76 100%);
            min-height: 100vh;
            color: #333;
        }
        .navbar {
            display: flex; justify-content: space-between; align-items: center;
            padding: 20px 40px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        .logo span {
            font-size: 24px; font-weight: 700;
            background: linear-gradient(135deg, #FF6B35, #FFD166);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .nav-tabs { display: flex; gap: 10px; }
        .tab {
            padding: 10px 20px;
            background: rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 10px;
            color: rgba(0,0,0,0.6);
            font-size: 14px; cursor: pointer;
            text-decoration: none;
        }
        .tab:hover { background: rgba(0,0,0,0.08); }
        .tab.active {
            background: linear-gradient(135deg, rgba(255,107,53,0.15), rgba(255,209,102,0.15));
            border-color: rgba(255,107,53,0.8);
            color: #FF6B35;
        }
        .hero { text-align: center; padding: 40px 20px 20px; }
        .hero h1 {
            font-size: 36px; font-weight: 700; margin-bottom: 12px;
            background: linear-gradient(135deg, #FF6B35, #D4A574);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .hero p { font-size: 16px; color: rgba(0,0,0,0.6); }
        .main-card {
            max-width: 900px; margin: 30px auto; padding: 24px;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(0,0,0,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block; margin-bottom: 8px;
            font-weight: 600; color: #333;
        }
        .text-input {
            width: 100%; padding: 16px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            resize: vertical;
            min-height: 100px;
        }
        .text-input:focus {
            outline: none;
            border-color: #FF6B35;
            box-shadow: 0 0 0 3px rgba(255,107,53,0.1);
        }
        .options-row {
            display: flex; gap: 20px; flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .option-group { flex: 1; min-width: 150px; }
        .option-group label {
            display: block; margin-bottom: 6px;
            font-size: 14px; color: #666;
        }
        .option-group select {
            width: 100%; padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            background: #fff;
            cursor: pointer;
        }
        .generate-btn {
            width: 100%; padding: 16px;
            background: linear-gradient(135deg, #FF6B35, #FFD166);
            border: none; border-radius: 12px;
            color: #fff; font-size: 16px; font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255,107,53,0.3);
        }
        .generate-btn:disabled {
            opacity: 0.6; cursor: not-allowed;
            transform: none; box-shadow: none;
        }
        .result-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #e0e0e0;
            display: none;
        }
        .result-section.show { display: block; }
        .result-title {
            font-size: 20px; font-weight: 600;
            margin-bottom: 20px; color: #333;
        }
        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        .image-card {
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #e0e0e0;
            background: #fff;
        }
        .image-card img {
            width: 100%;
            aspect-ratio: 3/4;
            object-fit: cover;
        }
        .image-card .caption {
            padding: 10px;
            font-size: 12px;
            color: #666;
            text-align: center;
        }
        .copy-section {
            background: #f9f9f9;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        .copy-section h3 {
            font-size: 16px;
            margin-bottom: 12px;
            color: #333;
        }
        .copy-content {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .tags-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        .tag {
            background: linear-gradient(135deg, rgba(255,107,53,0.1), rgba(255,209,102,0.1));
            border: 1px solid rgba(255,107,53,0.3);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            color: #FF6B35;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        .loading.show { display: block; }
        .spinner {
            width: 40px; height: 40px;
            border: 3px solid #f0f0f0;
            border-top-color: #FF6B35;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { color: #666; font-size: 14px; }
        .error-msg {
            background: #fff5f5;
            border: 1px solid #ffccc7;
            color: #cf1322;
            padding: 12px 16px;
            border-radius: 8px;
            margin-top: 16px;
            display: none;
        }
        .error-msg.show { display: block; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo"><span>vibe-blog</span></div>
        <div class="nav-tabs">
            <a href="/" class="tab">ğŸ“ é•¿æ–‡åšå®¢</a>
            <div class="tab active">ğŸ“• å°çº¢ä¹¦åˆ›ä½œ</div>
        </div>
    </nav>

    <section class="hero">
        <h1>ğŸ“• å°çº¢ä¹¦åˆ›ä½œåŠ©æ‰‹</h1>
        <p>è¾“å…¥ä¸»é¢˜ï¼Œä¸€é”®ç”Ÿæˆå°çº¢ä¹¦é£æ ¼ä¿¡æ¯å›¾ç³»åˆ—</p>
    </section>

    <div class="main-card">
        <div class="form-group">
            <label>ğŸ“Œ è¾“å…¥ä¸»é¢˜</label>
            <textarea class="text-input" id="topicInput" placeholder="ä¾‹å¦‚ï¼šRAGæŠ€æœ¯å…¥é—¨ã€Redisç¼“å­˜åŸç†ã€Pythonè£…é¥°å™¨è¯¦è§£..."></textarea>
        </div>

        <div class="options-row">
            <div class="option-group">
                <label>ğŸ“„ é¡µé¢æ•°é‡</label>
                <select id="countSelect">
                    <option value="3">3 é¡µ</option>
                    <option value="4" selected>4 é¡µ</option>
                    <option value="5">5 é¡µ</option>
                    <option value="6">6 é¡µ</option>
                </select>
            </div>
            <div class="option-group">
                <label>ğŸ¨ è§†è§‰é£æ ¼</label>
                <select id="styleSelect">
                    <option value="hand_drawn">æ¸©æš–æ‰‹ç»˜é£</option>
                    <option value="claymation">é»åœŸåŠ¨ç”»é£</option>
                    <option value="ghibli_summer">ğŸŒ» å®«å´éªçš„å¤å¤©ï¼ˆæ¼«ç”»åˆ†é•œï¼‰</option>
                </select>
            </div>
            <div class="option-group">
                <label>ğŸ¬ åŠ¨ç”»å°é¢</label>
                <select id="videoSelect">
                    <option value="true">ç”ŸæˆåŠ¨ç”»</option>
                    <option value="false">ä»…é™æ€å›¾</option>
                </select>
            </div>
        </div>

        <button class="generate-btn" id="generateBtn" onclick="generateXHS()">
            âœ¨ å¼€å§‹ç”Ÿæˆ
        </button>

        <div class="error-msg" id="errorMsg"></div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div class="loading-text" id="loadingText">æ­£åœ¨ç”Ÿæˆå¤§çº²...</div>
        </div>

        <div class="result-section" id="resultSection">
            <h2 class="result-title">ğŸ‰ ç”Ÿæˆå®Œæˆ</h2>
            
            <h3 style="margin-bottom: 12px;">ğŸ“· ä¿¡æ¯å›¾é¢„è§ˆ</h3>
            <div class="images-grid" id="imagesGrid"></div>

            <div class="copy-section">
                <h3>ğŸ“ æ¨èæ ‡é¢˜</h3>
                <div id="titlesList" style="margin-bottom: 16px;"></div>
                
                <h3>ğŸ“„ æ–‡æ¡ˆå†…å®¹</h3>
                <div class="copy-content" id="copyContent"></div>
                
                <h3 style="margin-top: 16px;">ğŸ·ï¸ æ¨èæ ‡ç­¾</h3>
                <div class="tags-list" id="tagsList"></div>
            </div>
            
            <!-- å‘å¸ƒæŒ‰é’®åŒºåŸŸ -->
            <div class="publish-section" style="margin-top: 24px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                <h3 style="margin-bottom: 12px;">ğŸš€ å‘å¸ƒåˆ°å°çº¢ä¹¦</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 16px;">
                    è¯·å…ˆåœ¨æµè§ˆå™¨ç™»å½•å°çº¢ä¹¦åˆ›ä½œè€…ä¸­å¿ƒï¼Œç„¶åä½¿ç”¨æµè§ˆå™¨æ‰©å±•å¯¼å‡º Cookie
                </p>
                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                    <button class="publish-btn" onclick="copyToClipboard()" style="
                        padding: 12px 24px;
                        background: #fff;
                        border: 1px solid #FF6B35;
                        border-radius: 8px;
                        color: #FF6B35;
                        font-size: 14px;
                        cursor: pointer;
                    ">
                        ğŸ“‹ å¤åˆ¶æ–‡æ¡ˆ
                    </button>
                    <button class="publish-btn" onclick="downloadImages()" style="
                        padding: 12px 24px;
                        background: #fff;
                        border: 1px solid #FF6B35;
                        border-radius: 8px;
                        color: #FF6B35;
                        font-size: 14px;
                        cursor: pointer;
                    ">
                        ğŸ“¥ ä¸‹è½½å›¾ç‰‡
                    </button>
                    <button class="publish-btn" onclick="openPublishDialog()" style="
                        padding: 12px 24px;
                        background: linear-gradient(135deg, #FF6B35, #FFD166);
                        border: none;
                        border-radius: 8px;
                        color: #fff;
                        font-size: 14px;
                        font-weight: 600;
                        cursor: pointer;
                    ">
                        ğŸš€ ä¸€é”®å‘å¸ƒ
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å‘å¸ƒå¼¹çª— -->
    <div id="publishModal" style="
        display: none;
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    ">
        <div style="
            background: #fff;
            border-radius: 16px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        ">
            <h3 style="margin-bottom: 16px;">ğŸ” è¾“å…¥å°çº¢ä¹¦ Cookie</h3>
            <p style="color: #666; font-size: 13px; margin-bottom: 12px;">
                åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…· â†’ Network â†’ ä»»æ„è¯·æ±‚ â†’ Headers â†’ Cookieï¼Œå¤åˆ¶ç²˜è´´å³å¯ï¼š
            </p>
            <textarea id="cookieInput" placeholder='ç›´æ¥ç²˜è´´ Cookie å­—ç¬¦ä¸²ï¼Œå¦‚: a]1=xxx; webId=yyy; web_session=zzz' style="
                width: 100%;
                height: 150px;
                padding: 12px;
                border: 1px solid #e0e0e0;
                border-radius: 8px;
                font-family: monospace;
                font-size: 12px;
                resize: vertical;
            "></textarea>
            <div style="display: flex; gap: 12px; margin-top: 16px; justify-content: flex-end;">
                <button onclick="closePublishDialog()" style="
                    padding: 10px 20px;
                    background: #f5f5f5;
                    border: none;
                    border-radius: 8px;
                    cursor: pointer;
                ">å–æ¶ˆ</button>
                <button onclick="publishToXHS()" style="
                    padding: 10px 20px;
                    background: linear-gradient(135deg, #FF6B35, #FFD166);
                    border: none;
                    border-radius: 8px;
                    color: #fff;
                    font-weight: 600;
                    cursor: pointer;
                ">ç¡®è®¤å‘å¸ƒ</button>
            </div>
        </div>
    </div>

    <script>
        async function generateXHS() {
            const topic = document.getElementById('topicInput').value.trim();
            if (!topic) {
                showError('è¯·è¾“å…¥ä¸»é¢˜');
                return;
            }

            const count = parseInt(document.getElementById('countSelect').value);
            const style = document.getElementById('styleSelect').value;
            const generateVideo = document.getElementById('videoSelect').value === 'true';

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('loading').classList.add('show');
            document.getElementById('resultSection').classList.remove('show');
            document.getElementById('errorMsg').classList.remove('show');

            try {
                updateLoadingText('æ­£åœ¨ç”Ÿæˆå¤§çº²...');
                
                const response = await fetch('/api/xhs/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        topic,
                        count,
                        style,
                        generate_video: generateVideo
                    })
                });

                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'ç”Ÿæˆå¤±è´¥');
                }

                // æ˜¾ç¤ºç»“æœ
                displayResult(result.data);

            } catch (error) {
                showError(error.message);
            } finally {
                document.getElementById('generateBtn').disabled = false;
                document.getElementById('loading').classList.remove('show');
            }
        }

        function displayResult(data) {
            // ä¿å­˜ç»“æœä¾›å‘å¸ƒä½¿ç”¨
            currentResult = data;
            
            // æ˜¾ç¤ºå›¾ç‰‡
            const imagesGrid = document.getElementById('imagesGrid');
            imagesGrid.innerHTML = '';
            
            if (data.image_urls && data.image_urls.length > 0) {
                data.image_urls.forEach((url, index) => {
                    const card = document.createElement('div');
                    card.className = 'image-card';
                    card.innerHTML = `
                        <img src="${url}" alt="ç¬¬${index + 1}å¼ " onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22267%22><rect fill=%22%23f0f0f0%22 width=%22200%22 height=%22267%22/><text x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%23999%22>å›¾ç‰‡åŠ è½½ä¸­</text></svg>'">
                        <div class="caption">ç¬¬ ${index + 1} é¡µ${index === 0 ? ' (å°é¢)' : ''}</div>
                    `;
                    imagesGrid.appendChild(card);
                });
            } else {
                imagesGrid.innerHTML = '<p style="color: #999; text-align: center; grid-column: 1/-1;">æš‚æ— å›¾ç‰‡ï¼ˆå›¾ç‰‡æœåŠ¡æœªé…ç½®ï¼‰</p>';
            }

            // æ˜¾ç¤ºæ ‡é¢˜
            const titlesList = document.getElementById('titlesList');
            if (data.titles && data.titles.length > 0) {
                titlesList.innerHTML = data.titles.map((title, i) => 
                    `<div style="padding: 8px 12px; background: ${i === 0 ? '#fff3e0' : '#f5f5f5'}; border-radius: 8px; margin-bottom: 8px; ${i === 0 ? 'border: 1px solid #FF6B35;' : ''}">
                        ${i === 0 ? 'â­ ' : ''}${title}
                    </div>`
                ).join('');
            } else {
                titlesList.innerHTML = '<p style="color: #999;">æš‚æ— æ ‡é¢˜</p>';
            }

            // æ˜¾ç¤ºæ–‡æ¡ˆ
            document.getElementById('copyContent').textContent = data.copywriting || 'æš‚æ— æ–‡æ¡ˆ';

            // æ˜¾ç¤ºæ ‡ç­¾
            const tagsList = document.getElementById('tagsList');
            if (data.tags && data.tags.length > 0) {
                tagsList.innerHTML = data.tags.map(tag => 
                    `<span class="tag">#${tag}</span>`
                ).join('');
            } else {
                tagsList.innerHTML = '<p style="color: #999;">æš‚æ— æ ‡ç­¾</p>';
            }

            // æ˜¾ç¤ºç»“æœåŒºåŸŸ
            document.getElementById('resultSection').classList.add('show');
        }

        function updateLoadingText(text) {
            document.getElementById('loadingText').textContent = text;
        }

        function showError(message) {
            const errorMsg = document.getElementById('errorMsg');
            errorMsg.textContent = 'âŒ ' + message;
            errorMsg.classList.add('show');
        }
        
        // å­˜å‚¨å½“å‰ç”Ÿæˆç»“æœ
        let currentResult = null;
        
        // ä¿å­˜ç”Ÿæˆç»“æœä¾›å‘å¸ƒä½¿ç”¨
        function saveResult(data) {
            currentResult = data;
        }
        
        // å¤åˆ¶æ–‡æ¡ˆåˆ°å‰ªè´´æ¿
        function copyToClipboard() {
            if (!currentResult) {
                alert('è¯·å…ˆç”Ÿæˆå†…å®¹');
                return;
            }
            
            const title = currentResult.titles?.[0] || '';
            const copy = currentResult.copywriting || '';
            const tags = (currentResult.tags || []).map(t => '#' + t).join(' ');
            
            const fullText = `${title}\n\n${copy}\n\n${tags}`;
            
            navigator.clipboard.writeText(fullText).then(() => {
                alert('âœ… æ–‡æ¡ˆå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
        }
        
        // ä¸‹è½½å›¾ç‰‡
        async function downloadImages() {
            if (!currentResult || !currentResult.image_urls || currentResult.image_urls.length === 0) {
                alert('æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡');
                return;
            }
            
            const urls = currentResult.image_urls;
            alert(`å¼€å§‹ä¸‹è½½ ${urls.length} å¼ å›¾ç‰‡ï¼Œè¯·å…è®¸æµè§ˆå™¨ä¸‹è½½å¤šä¸ªæ–‡ä»¶`);
            
            for (let i = 0; i < urls.length; i++) {
                const url = urls[i];
                try {
                    // ä½¿ç”¨ fetch ä¸‹è½½å¹¶åˆ›å»º blob
                    const response = await fetch(url);
                    const blob = await response.blob();
                    const blobUrl = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = blobUrl;
                    a.download = `xhs_${i + 1}.jpg`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(blobUrl);
                    
                    // å»¶è¿Ÿé¿å…æµè§ˆå™¨é˜»æ­¢
                    if (i < urls.length - 1) {
                        await new Promise(r => setTimeout(r, 500));
                    }
                } catch (e) {
                    console.error(`ä¸‹è½½ç¬¬ ${i + 1} å¼ å›¾ç‰‡å¤±è´¥:`, e);
                    // é™çº§ï¼šç›´æ¥æ‰“å¼€é“¾æ¥
                    window.open(url, '_blank');
                }
            }
        }
        
        // æ‰“å¼€å‘å¸ƒå¼¹çª—
        function openPublishDialog() {
            if (!currentResult) {
                alert('è¯·å…ˆç”Ÿæˆå†…å®¹');
                return;
            }
            document.getElementById('publishModal').style.display = 'flex';
        }
        
        // å…³é—­å‘å¸ƒå¼¹çª—
        function closePublishDialog() {
            document.getElementById('publishModal').style.display = 'none';
        }
        
        // è§£æ Cookie å­—ç¬¦ä¸²ï¼ˆæ”¯æŒå¤šç§æ ¼å¼ï¼‰
        function parseCookies(cookieText) {
            // å°è¯• JSON æ ¼å¼
            try {
                const parsed = JSON.parse(cookieText);
                if (Array.isArray(parsed)) return parsed;
            } catch (e) {}
            
            // è§£ææµè§ˆå™¨åŸå§‹ Cookie å­—ç¬¦ä¸²æ ¼å¼: "name1=value1; name2=value2"
            const cookies = [];
            const pairs = cookieText.split(';');
            for (const pair of pairs) {
                const trimmed = pair.trim();
                if (!trimmed) continue;
                const eqIndex = trimmed.indexOf('=');
                if (eqIndex > 0) {
                    cookies.push({
                        name: trimmed.substring(0, eqIndex).trim(),
                        value: trimmed.substring(eqIndex + 1).trim(),
                        domain: '.xiaohongshu.com',
                        path: '/'
                    });
                }
            }
            return cookies;
        }
        
        // å‘å¸ƒåˆ°å°çº¢ä¹¦
        async function publishToXHS() {
            const cookieText = document.getElementById('cookieInput').value.trim();
            
            if (!cookieText) {
                alert('è¯·è¾“å…¥ Cookie');
                return;
            }
            
            const cookies = parseCookies(cookieText);
            if (!cookies || cookies.length === 0) {
                alert('Cookie è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ ¼å¼');
                return;
            }
            
            if (!currentResult) {
                alert('è¯·å…ˆç”Ÿæˆå†…å®¹');
                return;
            }
            
            closePublishDialog();
            
            // æ˜¾ç¤ºå‘å¸ƒä¸­çŠ¶æ€
            document.getElementById('loading').classList.add('show');
            updateLoadingText('æ­£åœ¨å‘å¸ƒåˆ°å°çº¢ä¹¦...');
            
            try {
                const response = await fetch('/api/xhs/publish', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        cookies: cookies,
                        title: currentResult.titles?.[0] || '',
                        content: currentResult.copywriting || '',
                        tags: currentResult.tags || [],
                        images: currentResult.image_urls || []
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('ğŸ‰ å‘å¸ƒæˆåŠŸï¼' + (result.url ? '\nç¬”è®°é“¾æ¥: ' + result.url : ''));
                } else {
                    alert('âŒ å‘å¸ƒå¤±è´¥: ' + (result.error || result.message));
                }
            } catch (error) {
                alert('âŒ å‘å¸ƒå¤±è´¥: ' + error.message);
            } finally {
                document.getElementById('loading').classList.remove('show');
            }
        }
        
        // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
        document.getElementById('publishModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePublishDialog();
            }
        });
        
        // ä» URL å‚æ•°è¯»å–åšå®¢ä¿¡æ¯ï¼ˆæ”¯æŒä» index.html è·³è½¬ï¼‰
        (function() {
            const params = new URLSearchParams(window.location.search);
            const topic = params.get('topic');
            const sourceId = params.get('source_id');
            
            if (topic) {
                document.getElementById('topicInput').value = topic;
            }
            if (sourceId) {
                // å¯ä»¥å­˜å‚¨ sourceId ç”¨äºåç»­å…³è”
                window.xhsSourceId = sourceId;
            }
        })();
    </script>
</body>
</html>
